<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>In praise of jq</title>
    <meta name="description" content="jq, the valuable JSON flick knife">
    <link rel="stylesheet" href="/styles.css">
    <link rel="alternate" href="/feed.xml" type="application/atom+xml" title="jfg.name">
    <link rel="alternate" href="/feed.json" type="application/json" title="jfg.name">
  </head>
  <body>
    <header><img id="mugshot" src="https://avatars.githubusercontent.com/u/13489445" width="110px"><h1>jfg.name</h1>
      <p>Computer programmer.
</p>
      <nav><span class="nav-link">
          <a href="/">Home</a>
        </span><span class="nav-link">
          <a href="/projects/">Projects</a>
        </span><span class="nav-link">
          <a href="https://github.com/joefg">üñ•Ô∏è GitHub</a>
        </span></nav>
    </header>

    <main class="body-post">
      <div class="post">
  <div class="post-header">
    <h1 class="post-title">In praise of jq</h1>
    <em>
      <time class="post-date" datetime="16/07/2024">
      16/07/2024
      </time>
    </em></div>
  <hr>
  <div class="post-body">
    <p>Question for you: Given the following poorly-formatted set of lon/lat, how would
you assemble these into a <a href="https://geojson.org/">GeoJSON</a>?</p>
<pre><code class="language-json hljs"><span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">[</span><span class="hljs-number">-3.5</span><span class="hljs-punctuation">,</span> <span class="hljs-number">51</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">[</span><span class="hljs-number">-1.25</span><span class="hljs-punctuation">,</span> <span class="hljs-number">51.75</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">[</span><span class="hljs-number">1.24</span><span class="hljs-punctuation">,</span> <span class="hljs-number">52.64</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">]</span>
</code></pre>
<p>You could use Python.</p>
<pre><code class="language-python hljs"><span class="hljs-keyword">import</span> json

<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'file.json'</span>, <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> f:
    points = json.load(f)

ret = {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"FeatureCollection"</span>,
    <span class="hljs-string">"features"</span>: [
        {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"Feature"</span>,
            <span class="hljs-string">"properties"</span>: {},
            <span class="hljs-string">"geometry"</span>: {
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"Point"</span>,
                <span class="hljs-string">"coordinates"</span>: point
            }
        } <span class="hljs-keyword">for</span> point <span class="hljs-keyword">in</span> points
    ]
}

<span class="hljs-built_in">print</span>(json.dumps(ret, indent=<span class="hljs-number">4</span>))

<span class="hljs-comment"># {</span>
<span class="hljs-comment">#     "type": "FeatureCollection",</span>
<span class="hljs-comment">#     "features": [</span>
<span class="hljs-comment">#         {</span>
<span class="hljs-comment">#             "type": "Feature",</span>
<span class="hljs-comment">#             "properties": {},</span>
<span class="hljs-comment">#             "geometry": {</span>
<span class="hljs-comment">#                 "type": "Point",</span>
<span class="hljs-comment">#                 "coordinates": [</span>
<span class="hljs-comment">#                     -3.5,</span>
<span class="hljs-comment">#                     51</span>
<span class="hljs-comment">#                 ]</span>
<span class="hljs-comment">#             }</span>
<span class="hljs-comment">#         },</span>
<span class="hljs-comment">#         {</span>
<span class="hljs-comment">#             "type": "Feature",</span>
<span class="hljs-comment">#             "properties": {},</span>
<span class="hljs-comment">#             "geometry": {</span>
<span class="hljs-comment">#                 "type": "Point",</span>
<span class="hljs-comment">#                 "coordinates": [</span>
<span class="hljs-comment">#                     -1.25,</span>
<span class="hljs-comment">#                     51.75</span>
<span class="hljs-comment">#                 ]</span>
<span class="hljs-comment">#             }</span>
<span class="hljs-comment">#         },</span>
<span class="hljs-comment">#         {</span>
<span class="hljs-comment">#             "type": "Feature",</span>
<span class="hljs-comment">#             "properties": {},</span>
<span class="hljs-comment">#             "geometry": {</span>
<span class="hljs-comment">#                 "type": "Point",</span>
<span class="hljs-comment">#                 "coordinates": [</span>
<span class="hljs-comment">#                     1.24,</span>
<span class="hljs-comment">#                     52.64</span>
<span class="hljs-comment">#                 ]</span>
<span class="hljs-comment">#             }</span>
<span class="hljs-comment">#         }</span>
<span class="hljs-comment">#     ]</span>
<span class="hljs-comment"># }</span>
</code></pre>
<p>You could also use <code>jq</code>.</p>
<pre><code class="language-sh hljs language-bash">$ jq -s <span class="hljs-string">'
{
    "type" : "FeatureCollection",
    "features": [ .[] |
        {
            "type" : "Feature", 
            "properties": {}, 
            "geometry": 
                {
                    "type" : "Point",
                    "coordinates": .[]
                } 
        } 
    ]
}'</span> &lt; points.json 

<span class="hljs-comment">###</span>

{
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"FeatureCollection"</span>,
  <span class="hljs-string">"features"</span>: [
    {
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"Feature"</span>,
      <span class="hljs-string">"properties"</span>: {},
      <span class="hljs-string">"geometry"</span>: {
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"Point"</span>,
        <span class="hljs-string">"coordinates"</span>: [
          -3.5,
          51
        ]
      }
    },
    {
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"Feature"</span>,
      <span class="hljs-string">"properties"</span>: {},
      <span class="hljs-string">"geometry"</span>: {
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"Point"</span>,
        <span class="hljs-string">"coordinates"</span>: [
          -1.25,
          51.75
        ]
      }
    },
    {
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"Feature"</span>,
      <span class="hljs-string">"properties"</span>: {},
      <span class="hljs-string">"geometry"</span>: {
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"Point"</span>,
        <span class="hljs-string">"coordinates"</span>: [
          1.24,
          52.64
        ]
      }
    }
  ]
}
</code></pre>
<p><a href="https://stedolan.github.io/jq/">jq</a> is a marvel. It's a contender for being a
proper standard Linux tool. It's designed to be portable: don't have it on your
server? No problem, just <code>scp</code> the executable and it works exactly the same as
it does on your machine. It works nicely with <code>stdin</code> and <code>stdout</code>. There's a
build for <a href="https://stedolan.github.io/jq/download/">most operating systems</a>, and
if there wasn't, building it is easy provided you have a good C compiler.</p>
<p>If you have <a href="https://github.com/junegunn/fzf">fzf</a> installed (and you should),
you can have a rudimentary <code>jq</code> REPL in your terminal on a file of your choice.</p>
<pre><code class="language-sh hljs language-bash"><span class="hljs-function"><span class="hljs-title">fjson</span></span>() {
    <span class="hljs-built_in">echo</span> <span class="hljs-string">''</span> | fzf --print-query --preview <span class="hljs-string">"cat *.json | jq {q}"</span>
}
</code></pre>
<p>Just piping a JSON string into <code>jq</code> prettifies it by default, and adds colours
if it detects that it's in a terminal.</p>
<pre><code class="language-sh hljs language-bash">$ jq &lt; points.json 

<span class="hljs-comment">###</span>

[
  [
    -3.5,
    51
  ],
  [
    -1.25,
    51.75
  ],
  [
    1.24,
    52.64
  ]
]
</code></pre>
<p>If your JSON's too big, it even minifies it with <code>-c</code>.</p>
<pre><code class="language-sh hljs language-bash">$ jq -c &lt; points.json

<span class="hljs-comment">###</span>

[[-3.5,51],[-1.25,51.75],[1.24,52.64]]
</code></pre>
<p>Frankly, it should be installed by default on all operating systems. It's that
useful.</p>

  </div>
</div>
    </main>

   <hr>
   <footer><span class="footer-item">
        Made with deno and lume in England üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø.
      </span><span class="footer-item">
        <a href="/feed.rss">üì∂ RSS Feed</a>
      </span>
    </footer>
  

</body></html>